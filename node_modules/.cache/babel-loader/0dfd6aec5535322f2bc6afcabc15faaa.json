{"ast":null,"code":"import _asyncToGenerator from\"/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,useCallback}from\"react\";import*as d3 from\"d3\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Correlation(data){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),statesData=_useState2[0],setStatesData=_useState2[1];//react用来注释数据\nvar ref=React.useRef(null);// console.log(data)\nvar _useState3=useState({width:document.documentElement.clientWidth,hieght:document.documentElement.clientHeight}),_useState4=_slicedToArray(_useState3,2),size=_useState4[0],setSize=_useState4[1];var onResize=useCallback(function(){setSize({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight});},[]);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var margin,width,height,svgEL,svg,tooltip;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:window.addEventListener('resize',onResize);// set the dimensions and margins of the graph\nmargin={top:10,right:30,bottom:30,left:60},width=ref.current.clientWidth-30,height=400-margin.top-margin.bottom;svgEL=d3.select(ref.current);svgEL.selectAll(\"*\").remove();// append the svg object to the body of the page\nsvg=svgEL.append(\"svg\").attr(\"width\",width+margin.left+margin.right).attr(\"height\",height+margin.top+margin.bottom).append(\"g\").attr(\"transform\",\"translate(\".concat(margin.left,\", \").concat(margin.top,\")\"));tooltip=d3.select(\".usCorrelation\").append(\"div\").style(\"opacity\",0).attr(\"class\",\"tooltip\").style(\"background-color\",\"white\").style(\"border\",\"solid\").style(\"border-width\",\"1px\").style(\"border-radius\",\"5px\").style(\"padding\",\"10px\");//Read the data\nd3.csv(\"./data/state.csv\").then(function(data){// Add X axis\nvar x=d3.scaleLinear().domain([0,110]).range([0,width]);svg.append(\"g\").attr(\"transform\",\"translate(0, \".concat(height,\")\")).call(d3.axisBottom(x));// Add Y axis\nvar y=d3.scaleLinear().domain([0,0.7]).range([height,0]);svg.append(\"g\").call(d3.axisLeft(y));// Color scale: give me a specie name, I return a color\nvar color=d3.scaleLinear().domain([-25,20]).range([\"red\",\"blue\"]);// Highlight the specie that is hovered\nvar highlight=function highlight(event,d){var selected_specie=d.rate;tooltip.style(\"opacity\",1);d3.selectAll(\".dot\").transition().duration(200).style(\"fill\",\"lightgrey\").attr(\"r\",3);d3.selectAll(\"#\"+\"dot\"+d.state).transition().duration(200).style(\"fill\",color(selected_specie)).attr(\"r\",5);};// Highlight the specie that is hovered\nvar doNotHighlight=function doNotHighlight(event,d){tooltip.transition().duration(200).style(\"opacity\",0);d3.selectAll(\".dot\").transition().duration(200).style(\"fill\",function(d){return color(d.rate);}).attr(\"r\",3);};var mousemove=function mousemove(event,d){tooltip.html(\"\".concat(d.state,\": with a gun possessing rate of \").concat(d.gunhold,\" and \").concat(106-d.policy,\" qualifications on gun holding\")).style(\"left\",event.x/2+\"px\")// It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect\n.style(\"top\",event.y/2+\"px\");};svg.append('g').selectAll(\"dot\").data(data).enter().append(\"circle\").attr(\"class\",function(d){return\"dot \"+d.rate;}).attr(\"id\",function(d){console.log(d.state);return\"dot\"+d.state;}).attr(\"cx\",function(d){return x(106-d.policy);}).attr(\"cy\",function(d){return y(d.gunhold);}).attr(\"r\",3).style(\"fill\",function(d){return color(d.rate);}).on(\"mouseover\",highlight).on(\"mouseleave\",doNotHighlight).on(\"mousemove\",mousemove);svg.append('g');});return _context.abrupt(\"return\",function(){window.removeEventListener('resize',onResize);});case 8:case\"end\":return _context.stop();}}},_callee);}))();},[statesData.length,size.width]);return/*#__PURE__*/_jsxs(\"div\",{className:\"down-chart-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chart-title\",children:\"RELATION between POLICY & VOTE\"}),/*#__PURE__*/_jsx(\"div\",{className:\"down-chart usCorrelation\",ref:ref}),/*#__PURE__*/_jsxs(\"div\",{className:\"down-chart-example\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"./media/party-relate.svg\",width:\"95%\"}),\" \"]})]})//渲染了这个东西出来\n;}export default Correlation;","map":{"version":3,"sources":["/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/src/charts/Correlation.js"],"names":["React","useState","useEffect","useCallback","d3","Correlation","data","statesData","setStatesData","ref","useRef","width","document","documentElement","clientWidth","hieght","clientHeight","size","setSize","onResize","height","window","addEventListener","margin","top","right","bottom","left","current","svgEL","select","selectAll","remove","svg","append","attr","tooltip","style","csv","then","x","scaleLinear","domain","range","call","axisBottom","y","axisLeft","color","highlight","event","d","selected_specie","rate","transition","duration","state","doNotHighlight","mousemove","html","gunhold","policy","enter","console","log","on","removeEventListener","length"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\"\r\nimport * as d3 from \"d3\"\r\n\r\nfunction Correlation(data) {\r\n    const [statesData, setStatesData] = useState([]);     //react用来注释数据\r\n    const ref = React.useRef(null)\r\n    // console.log(data)\r\n    const [size, setSize] = useState({\r\n        width: document.documentElement.clientWidth,\r\n        hieght: document.documentElement.clientHeight\r\n      })\r\n    \r\n      const onResize = useCallback(() => {\r\n        setSize({\r\n          width: document.documentElement.clientWidth,\r\n          height: document.documentElement.clientHeight,\r\n        })\r\n      }, [])\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n\r\n            window.addEventListener('resize', onResize);\r\n            // set the dimensions and margins of the graph\r\n            const margin = { top: 10, right: 30, bottom: 30, left: 60 },\r\n                width = ref.current.clientWidth-30,\r\n                height = 400 - margin.top - margin.bottom;\r\n      const svgEL = d3.select(ref.current);\r\n      svgEL.selectAll(\"*\").remove();\r\n\r\n            // append the svg object to the body of the page\r\n            const svg = svgEL\r\n                .append(\"svg\")\r\n                .attr(\"width\", width + margin.left + margin.right)\r\n                .attr(\"height\", height + margin.top + margin.bottom)\r\n                .append(\"g\")\r\n                .attr(\"transform\",\r\n                    `translate(${margin.left}, ${margin.top})`);\r\n\r\n            const tooltip = d3.select(\".usCorrelation\")\r\n                .append(\"div\")\r\n                .style(\"opacity\", 0)\r\n                .attr(\"class\", \"tooltip\")\r\n                .style(\"background-color\", \"white\")\r\n                .style(\"border\", \"solid\")\r\n                .style(\"border-width\", \"1px\")\r\n                .style(\"border-radius\", \"5px\")\r\n                .style(\"padding\", \"10px\")\r\n\r\n            //Read the data\r\n            d3.csv(\"./data/state.csv\").then(function (data) {\r\n                // Add X axis\r\n                const x = d3.scaleLinear()\r\n                    .domain([0, 110])\r\n                    .range([0, width]);\r\n                svg.append(\"g\")\r\n                    .attr(\"transform\", `translate(0, ${height})`)\r\n                    .call(d3.axisBottom(x));\r\n\r\n                // Add Y axis\r\n                const y = d3.scaleLinear()\r\n                    .domain([0, 0.7])\r\n                    .range([height, 0]);\r\n                svg.append(\"g\")\r\n                    .call(d3.axisLeft(y));\r\n\r\n                // Color scale: give me a specie name, I return a color\r\n                const color = d3.scaleLinear().domain([-25, 20])\r\n                    .range([\"red\", \"blue\"])\r\n\r\n                // Highlight the specie that is hovered\r\n                const highlight = function (event, d) {\r\n                    const selected_specie = d.rate\r\n\r\n                    tooltip\r\n                        .style(\"opacity\", 1)\r\n\r\n                    d3.selectAll(\".dot\")\r\n                        .transition()\r\n                        .duration(200)\r\n                        .style(\"fill\", \"lightgrey\")\r\n                        .attr(\"r\", 3)\r\n\r\n                    d3.selectAll(\"#\" + \"dot\" + d.state)\r\n                        .transition()\r\n                        .duration(200)\r\n                        .style(\"fill\", color(selected_specie))\r\n                        .attr(\"r\", 5)\r\n                }\r\n\r\n                // Highlight the specie that is hovered\r\n                const doNotHighlight = function (event, d) {\r\n                    tooltip\r\n                        .transition()\r\n                        .duration(200)\r\n                        .style(\"opacity\", 0)\r\n\r\n                    d3.selectAll(\".dot\")\r\n                        .transition()\r\n                        .duration(200)\r\n                        .style(\"fill\", d => color(d.rate))\r\n                        .attr(\"r\", 3)\r\n                }\r\n                const mousemove = function (event, d) {\r\n                    tooltip\r\n                        .html(`${d.state}: with a gun possessing rate of ${d.gunhold} and ${106 - d.policy} qualifications on gun holding`)\r\n                        .style(\"left\", (event.x) / 2 + \"px\") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect\r\n                        .style(\"top\", (event.y) / 2 + \"px\")\r\n                }\r\n                svg.append('g')\r\n                    .selectAll(\"dot\")\r\n                    .data(data)\r\n                    .enter()\r\n                    .append(\"circle\")\r\n                    .attr(\"class\", function (d) { return \"dot \" + d.rate })\r\n                    .attr(\"id\", function (d) { console.log(d.state); return \"dot\" + d.state })\r\n                    .attr(\"cx\", function (d) { return x(106 - d.policy); })\r\n                    .attr(\"cy\", function (d) { return y(d.gunhold); })\r\n                    .attr(\"r\", 3)\r\n                    .style(\"fill\", function (d) { return color(d.rate); })\r\n                    .on(\"mouseover\", highlight)\r\n                    .on(\"mouseleave\", doNotHighlight)\r\n                    .on(\"mousemove\", mousemove)\r\n                svg.append('g')\r\n\r\n            })\r\n\r\n            return (() => {\r\n                window.removeEventListener('resize', onResize)\r\n              })\r\n        })();\r\n    }, [statesData.length, size.width]\r\n    )\r\n\r\n    return (\r\n        <div className=\"down-chart-container\">\r\n            <div className=\"chart-title\">{\"RELATION between POLICY & VOTE\"}</div>\r\n            <div className=\"down-chart usCorrelation\" ref={ref}></div>\r\n            <div className=\"down-chart-example\"><img src=\"./media/party-relate.svg\" width=\"95%\"/> </div>\r\n        </div>   //渲染了这个东西出来\r\n    )\r\n}\r\n\r\nexport default Correlation"]},"metadata":{},"sourceType":"module"}