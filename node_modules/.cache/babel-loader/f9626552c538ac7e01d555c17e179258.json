{"ast":null,"code":"import _asyncToGenerator from\"/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,useCallback}from\"react\";import*as d3 from\"d3\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Data_sum(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),statesData=_useState2[0],setStatesData=_useState2[1];//react用来注释数据\nvar ref=React.useRef(null);// const [selectedVar, setSelectedVar] = useState(\"Case Number\")\n// const [var2, setVar2] = useState(\"Killed\")\n// const [var3, setVar3] = useState(\"Injured\")\n// console.log(data)\nvar _useState3=useState({width:document.documentElement.clientWidth,hieght:document.documentElement.clientHeight}),_useState4=_slicedToArray(_useState3,2),size=_useState4[0],setSize=_useState4[1];var onResize=useCallback(function(){setSize({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight});},[]);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var margin,width,height,innerRadius,outerRadius,svgEL,svg;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:window.addEventListener('resize',onResize);// set the dimensions and margins of the graph\nmargin={top:100,right:0,bottom:0,left:0},width=ref.current.clientWidth-30,height=width*1.4-margin.top-margin.bottom,innerRadius=150,outerRadius=Math.min(width,height)/2;// the outerRadius goes from the middle of the SVG area to the border\nsvgEL=d3.select(ref.current);svgEL.selectAll(\"*\").remove();// append the svg object to the body of the page\nsvg=svgEL.append(\"svg\").attr(\"width\",width+margin.left+margin.right).attr(\"height\",height+margin.top+margin.bottom).append(\"g\").attr(\"transform\",\"translate(\".concat(width/2+margin.left,\", \").concat(height/2+margin.top,\")\"));d3.csv(\"./data/state_sum.csv\").then(function(data){// X scale: common for 2 data series\nvar x=d3.scaleBand().range([0,2*Math.PI])// X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle\n.align(0)// This does nothing\n.domain(data.map(function(d){return d.state;}));// The domain of the X axis is the list of states.\n// Y scale outer variable\nvar y=d3.scaleRadial().range([innerRadius,outerRadius])// Domain will be define later.\n.domain([0,2000]);// Domain of Y is from 0 to the max seen in the data\n// Second barplot Scales\nvar ybis=d3.scaleRadial().range([innerRadius,5])// Domain will be defined later.\n.domain([0,2000]);// Add the bars\nsvg.append(\"g\").selectAll(\"path\").data(data).join(\"path\").attr(\"fill\",\"#a52723\").attr(\"class\",\"yo\").attr(\"d\",d3.arc()// imagine your doing a part of a donut plot\n.innerRadius(innerRadius).outerRadius(function(d){return y(d.KI);}).startAngle(function(d){return x(d.state);}).endAngle(function(d){return x(d.state)+x.bandwidth();}).padAngle(0.01).padRadius(innerRadius));// Add the labels\nsvg.append(\"g\").selectAll(\"g\").data(data).join(\"g\").attr(\"text-anchor\",function(d){return(x(d.state)+x.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?\"end\":\"start\";}).attr(\"transform\",function(d){return\"rotate(\"+((x(d.state)+x.bandwidth()/2)*180/Math.PI-90)+\")\"+\"translate(\"+(y(d.KI)+10)+\",0)\";}).append(\"text\").text(function(d){return d.state;}).attr(\"transform\",function(d){return(x(d.state)+x.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?\"rotate(180)\":\"rotate(0)\";}).style(\"font-size\",\"11px\").attr(\"alignment-baseline\",\"middle\");// Add the second series\nsvg.append(\"g\").selectAll(\"path\").data(data).join(\"path\").attr(\"fill\",\"grey\").attr(\"d\",d3.arc()// imagine your doing a part of a donut plot\n.innerRadius(function(d){return ybis(0);}).outerRadius(function(d){return ybis(d.KI);}).startAngle(function(d){return x(d.state);}).endAngle(function(d){return x(d.state)+x.bandwidth();}).padAngle(0.01).padRadius(innerRadius));});return _context.abrupt(\"return\",function(){window.removeEventListener('resize',onResize);});case 7:case\"end\":return _context.stop();}}},_callee);}))();},[statesData.length,size.width]);return/*#__PURE__*/_jsxs(\"div\",{className:\"down-chart-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chart-title\",children:\"SUM of GUN HOLD POLICY in each STATE\"}),/*#__PURE__*/_jsx(\"div\",{viewBox:\"0 0 960 600\",className:\"usData_sum\",ref:ref})]});}export default Data_sum;","map":{"version":3,"sources":["/Users/lion/Documents/GitHub/Gun_Violence_US_Visualization/src/charts/Data_sum.js"],"names":["React","useState","useEffect","useCallback","d3","Data_sum","props","statesData","setStatesData","ref","useRef","width","document","documentElement","clientWidth","hieght","clientHeight","size","setSize","onResize","height","window","addEventListener","margin","top","right","bottom","left","current","innerRadius","outerRadius","Math","min","svgEL","select","selectAll","remove","svg","append","attr","csv","then","data","x","scaleBand","range","PI","align","domain","map","d","state","y","scaleRadial","ybis","join","arc","KI","startAngle","endAngle","bandwidth","padAngle","padRadius","text","style","removeEventListener","length"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\"\r\nimport * as d3 from \"d3\"\r\n\r\nfunction Data_sum(props) {\r\n    const [statesData, setStatesData] = useState([]);     //react用来注释数据\r\n    const ref = React.useRef(null)\r\n    // const [selectedVar, setSelectedVar] = useState(\"Case Number\")\r\n    // const [var2, setVar2] = useState(\"Killed\")\r\n    // const [var3, setVar3] = useState(\"Injured\")\r\n    // console.log(data)\r\n    const [size, setSize] = useState({\r\n        width: document.documentElement.clientWidth,\r\n        hieght: document.documentElement.clientHeight\r\n    })\r\n\r\n    const onResize = useCallback(() => {\r\n        setSize({\r\n            width: document.documentElement.clientWidth,\r\n            height: document.documentElement.clientHeight,\r\n        })\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            window.addEventListener('resize', onResize);\r\n            // set the dimensions and margins of the graph\r\n            const margin = { top: 100, right: 0, bottom: 0, left: 0 },\r\n                width = ref.current.clientWidth - 30,\r\n                height = width * 1.4 - margin.top - margin.bottom,\r\n                innerRadius = 150,\r\n                outerRadius = Math.min(width, height) / 2;   // the outerRadius goes from the middle of the SVG area to the border\r\n\r\n            const svgEL = d3.select(ref.current);\r\n            svgEL.selectAll(\"*\").remove();\r\n\r\n            // append the svg object to the body of the page\r\n            const svg = svgEL\r\n                .append(\"svg\")\r\n                .attr(\"width\", width + margin.left + margin.right)\r\n                .attr(\"height\", height + margin.top + margin.bottom)\r\n                .append(\"g\")\r\n                .attr(\"transform\", `translate(${width / 2 + margin.left}, ${height / 2 + margin.top})`);\r\n\r\n            d3.csv(\"./data/state_sum.csv\").then(function (data) {\r\n\r\n                // X scale: common for 2 data series\r\n                const x = d3.scaleBand()\r\n                    .range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle\r\n                    .align(0)                  // This does nothing\r\n                    .domain(data.map(d => d.state)); // The domain of the X axis is the list of states.\r\n\r\n                // Y scale outer variable\r\n                const y = d3.scaleRadial()\r\n                    .range([innerRadius, outerRadius])   // Domain will be define later.\r\n                    .domain([0, 2000]); // Domain of Y is from 0 to the max seen in the data\r\n\r\n                // Second barplot Scales\r\n                const ybis = d3.scaleRadial()\r\n                    .range([innerRadius, 5])   // Domain will be defined later.\r\n                    .domain([0, 2000]);\r\n\r\n                // Add the bars\r\n                svg.append(\"g\")\r\n                    .selectAll(\"path\")\r\n                    .data(data)\r\n                    .join(\"path\")\r\n                    .attr(\"fill\", \"#a52723\")\r\n                    .attr(\"class\", \"yo\")\r\n                    .attr(\"d\", d3.arc()     // imagine your doing a part of a donut plot\r\n                        .innerRadius(innerRadius)\r\n                        .outerRadius(d => y(d.KI))\r\n                        .startAngle(d => x(d.state))\r\n                        .endAngle(d => x(d.state) + x.bandwidth())\r\n                        .padAngle(0.01)\r\n                        .padRadius(innerRadius))\r\n\r\n                // Add the labels\r\n                svg.append(\"g\")\r\n                    .selectAll(\"g\")\r\n                    .data(data)\r\n                    .join(\"g\")\r\n                    .attr(\"text-anchor\", function (d) { return (x(d.state) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? \"end\" : \"start\"; })\r\n                    .attr(\"transform\", function (d) { return \"rotate(\" + ((x(d.state) + x.bandwidth() / 2) * 180 / Math.PI - 90) + \")\" + \"translate(\" + (y(d.KI) + 10) + \",0)\"; })\r\n                    .append(\"text\")\r\n                    .text(d => d.state)\r\n                    .attr(\"transform\", function (d) { return (x(d.state) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? \"rotate(180)\" : \"rotate(0)\"; })\r\n                    .style(\"font-size\", \"11px\")\r\n                    .attr(\"alignment-baseline\", \"middle\")\r\n\r\n                // Add the second series\r\n                svg.append(\"g\")\r\n                    .selectAll(\"path\")\r\n                    .data(data)\r\n                    .join(\"path\")\r\n                    .attr(\"fill\", \"grey\")\r\n                    .attr(\"d\", d3.arc()     // imagine your doing a part of a donut plot\r\n                        .innerRadius(d => ybis(0))\r\n                        .outerRadius(d => ybis(d.KI))\r\n                        .startAngle(d => x(d.state))\r\n                        .endAngle(d => x(d.state) + x.bandwidth())\r\n                        .padAngle(0.01)\r\n                        .padRadius(innerRadius))\r\n\r\n            });\r\n            return (() => {\r\n                window.removeEventListener('resize', onResize)\r\n            })\r\n        })();\r\n    }, [statesData.length, size.width]\r\n    )\r\n    return (\r\n        <div className=\"down-chart-container\">\r\n            <div className=\"chart-title\">SUM of GUN HOLD POLICY in each STATE</div>\r\n            <div viewBox=\"0 0 960 600\" className=\"usData_sum\" ref={ref}></div>\r\n            {/* <div className=\"down-chart-example\"><img src=\"./profile.svg\" height=\"150px\"/> </div> */}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Data_sum"]},"metadata":{},"sourceType":"module"}